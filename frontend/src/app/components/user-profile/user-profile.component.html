<div class="profile-container">
  <div class="profile-header">
    <div class="profile-header-content">
      <div class="profile-avatar-section">
        <div class="profile-avatar">
          <div class="avatar-initials">{{ userProfile?.initials || 'DP' }}</div>
        </div>
        <h1 class="profile-title">{{ userProfile?.fullName || 'Loading...' }}</h1>
        <p class="profile-subtitle">{{ userProfile?.email || '' }}</p>
      </div>
    </div>
  </div>

  <div class="profile-content">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner"></div>
      <p class="loading-text">Loading profile...</p>
    </div>

    <!-- Profile Content -->
    <div *ngIf="!loading && userProfile" class="profile-form-container">
      <!-- Profile Information Section -->
      <div class="profile-section">
        <div class="section-header">
          <h2 class="section-title">Profile Information</h2>
          <button 
            *ngIf="!editing" 
            class="btn btn-outline-primary" 
            (click)="toggleEdit()"
            type="button">
            <i class="icon-edit"></i>
            Edit Profile
          </button>
        </div>

        <div class="profile-display" *ngIf="!editing">
          <div class="info-grid">
            <div class="info-item">
              <label class="info-label">First Name</label>
              <p class="info-value">{{ userProfile?.firstName }}</p>
            </div>
            <div class="info-item">
              <label class="info-label">Last Name</label>
              <p class="info-value">{{ userProfile?.lastName }}</p>
            </div>
            <div class="info-item">
              <label class="info-label">Username</label>
              <p class="info-value">{{ userProfile?.username }}</p>
            </div>
            <div class="info-item">
              <label class="info-label">Email</label>
              <p class="info-value">{{ userProfile?.email }}</p>
            </div>
            <div class="info-item">
              <label class="info-label">Phone</label>
              <p class="info-value">{{ userProfile?.phone || 'Not provided' }}</p>
            </div>
            <div class="info-item">
              <label class="info-label">Default Currency</label>
              <p class="info-value">{{ getCurrencyName(userProfile?.defaultCurrency || 'USD') }}</p>
            </div>
            <div class="info-item">
              <label class="info-label">Language</label>
              <p class="info-value">
                {{ getLanguageName(userProfile?.language || 'en') }}
              </p>
            </div>
            <div class="info-item">
              <label class="info-label">Last Login</label>
              <p class="info-value">{{ userProfile?.lastLogin }}</p>
            </div>
          </div>
        </div>

        <!-- Edit Form -->
        <form *ngIf="editing" [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
          <!-- Error Message -->
          <div *ngIf="errorMessage" class="alert alert-danger">
            <i class="icon-alert-circle"></i>
            {{ errorMessage }}
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="firstName" class="form-label required">First Name</label>
              <input 
                id="firstName"
                type="text" 
                class="form-control"
                formControlName="firstName"
                [class.error]="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched">
              <div *ngIf="profileForm.get('firstName')?.errors && profileForm.get('firstName')?.touched" 
                   class="error-message">
                <span *ngIf="profileForm.get('firstName')?.errors?.['required']">First name is required</span>
                <span *ngIf="profileForm.get('firstName')?.errors?.['minlength']">First name must be at least 2 characters</span>
              </div>
            </div>

            <div class="form-group">
              <label for="lastName" class="form-label required">Last Name</label>
              <input 
                id="lastName"
                type="text" 
                class="form-control"
                formControlName="lastName"
                [class.error]="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched">
              <div *ngIf="profileForm.get('lastName')?.errors && profileForm.get('lastName')?.touched" 
                   class="error-message">
                <span *ngIf="profileForm.get('lastName')?.errors?.['required']">Last name is required</span>
                <span *ngIf="profileForm.get('lastName')?.errors?.['minlength']">Last name must be at least 2 characters</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="phone" class="form-label">Phone Number</label>
            <input 
              id="phone"
              type="tel" 
              class="form-control"
              formControlName="phone"
              placeholder="+1 (555) 123-4567">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="defaultCurrency" class="form-label required">Default Currency</label>
              <select 
                id="defaultCurrency"
                class="form-control"
                formControlName="defaultCurrency">
                <option *ngFor="let currency of currencies" [value]="currency">
                  {{ getCurrencyName(currency) }} ({{ currency }})
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="language" class="form-label required">Language</label>
              <select 
                id="language"
                class="form-control"
                formControlName="language">
                <option *ngFor="let lang of languages" [value]="lang.code">
                  {{ lang.name }}
                </option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button 
              type="button" 
              class="btn btn-secondary" 
              (click)="cancelEdit()"
              [disabled]="saving">
              Cancel
            </button>
            <button 
              type="submit" 
              class="btn btn-primary" 
              [disabled]="profileForm.invalid || saving">
              <div *ngIf="saving" class="btn-spinner"></div>
              {{ saving ? 'Saving...' : 'Save Changes' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Notification Preferences Section -->
      <div class="profile-section">
        <div class="section-header">
          <h2 class="section-title">Notification Preferences</h2>
        </div>

        <div class="notification-display" *ngIf="!editing">
          <div class="notification-grid">
            <div class="notification-item">
              <div class="notification-info">
                <h4 class="notification-name">Email Notifications</h4>
                <p class="notification-description">Receive notifications via email</p>
              </div>
              <div class="notification-status">
                <span class="status-badge" [class.active]="userProfile?.emailNotifications">
                  {{ userProfile?.emailNotifications ? 'Enabled' : 'Disabled' }}
                </span>
              </div>
            </div>

            <div class="notification-item">
              <div class="notification-info">
                <h4 class="notification-name">Push Notifications</h4>
                <p class="notification-description">Receive push notifications in browser</p>
              </div>
              <div class="notification-status">
                <span class="status-badge" [class.active]="userProfile?.pushNotifications">
                  {{ userProfile?.pushNotifications ? 'Enabled' : 'Disabled' }}
                </span>
              </div>
            </div>

            <div class="notification-item">
              <div class="notification-info">
                <h4 class="notification-name">Expense Notifications</h4>
                <p class="notification-description">Get notified about new expenses</p>
              </div>
              <div class="notification-status">
                <span class="status-badge" [class.active]="userProfile?.expenseNotifications">
                  {{ userProfile?.expenseNotifications ? 'Enabled' : 'Disabled' }}
                </span>
              </div>
            </div>

            <div class="notification-item">
              <div class="notification-info">
                <h4 class="notification-name">Settlement Notifications</h4>
                <p class="notification-description">Get notified about settlements</p>
              </div>
              <div class="notification-status">
                <span class="status-badge" [class.active]="userProfile?.settlementNotifications">
                  {{ userProfile?.settlementNotifications ? 'Enabled' : 'Disabled' }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Notification Preferences Form -->
        <form *ngIf="editing" [formGroup]="profileForm" class="notification-form">
          <div class="notification-toggles">
            <div class="toggle-item">
              <div class="toggle-info">
                <h4 class="toggle-name">Email Notifications</h4>
                <p class="toggle-description">Receive notifications via email</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" formControlName="emailNotifications">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="toggle-item">
              <div class="toggle-info">
                <h4 class="toggle-name">Push Notifications</h4>
                <p class="toggle-description">Receive push notifications in browser</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" formControlName="pushNotifications">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="toggle-item">
              <div class="toggle-info">
                <h4 class="toggle-name">Expense Notifications</h4>
                <p class="toggle-description">Get notified about new expenses</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" formControlName="expenseNotifications">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="toggle-item">
              <div class="toggle-info">
                <h4 class="toggle-name">Settlement Notifications</h4>
                <p class="toggle-description">Get notified about settlements</p>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" formControlName="settlementNotifications">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </form>
      </div>

      <!-- Account Security Section -->
      <div class="profile-section">
        <div class="section-header">
          <h2 class="section-title">Account Security</h2>
        </div>

        <div class="security-grid">
          <div class="security-item">
            <div class="security-info">
              <h4 class="security-name">Two-Factor Authentication</h4>
              <p class="security-description">Add an extra layer of security to your account</p>
            </div>
            <div class="security-status">
              <span class="status-badge" [class.active]="userProfile?.twoFactorEnabled">
                {{ userProfile?.twoFactorEnabled ? 'Enabled' : 'Disabled' }}
              </span>
              <button class="btn btn-sm btn-outline-primary" type="button">
                {{ userProfile?.twoFactorEnabled ? 'Disable' : 'Enable' }}
              </button>
            </div>
          </div>

          <div class="security-item">
            <div class="security-info">
              <h4 class="security-name">Change Password</h4>
              <p class="security-description">Update your password to keep your account secure</p>
            </div>
            <div class="security-status">
              <button class="btn btn-sm btn-outline-primary" type="button">
                Change Password
              </button>
            </div>
          </div>

          <div class="security-item">
            <div class="security-info">
              <h4 class="security-name">Account Status</h4>
              <p class="security-description">Your account verification status</p>
            </div>
            <div class="security-status">
              <span class="status-badge active">
                {{ userProfile?.isVerified ? 'Verified' : 'Unverified' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Success Message -->
      <div *ngIf="successMessage" class="alert alert-success">
        <i class="icon-check-circle"></i>
        {{ successMessage }}
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="!loading && !userProfile" class="error-container">
      <div class="error-icon">
        <i class="icon-alert-triangle"></i>
      </div>
      <h3>Failed to Load Profile</h3>
      <p>We couldn't load your profile information. Please try again.</p>
      <button class="btn btn-primary" (click)="loadUserProfile()">
        Retry
      </button>
    </div>
  </div>
</div>

